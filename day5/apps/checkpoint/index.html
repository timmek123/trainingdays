<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Pre-day 5 checkpoint | Azure Developer College</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/trainingdays/assets/css/0.styles.6f1621c0.css" as="style"><link rel="preload" href="/trainingdays/assets/js/app.41048ffd.js" as="script"><link rel="preload" href="/trainingdays/assets/js/2.8660cf7d.js" as="script"><link rel="preload" href="/trainingdays/assets/js/7.5b737215.js" as="script"><link rel="prefetch" href="/trainingdays/assets/js/10.12c2779d.js"><link rel="prefetch" href="/trainingdays/assets/js/11.1a1030ef.js"><link rel="prefetch" href="/trainingdays/assets/js/12.2f958afc.js"><link rel="prefetch" href="/trainingdays/assets/js/13.b8ce6259.js"><link rel="prefetch" href="/trainingdays/assets/js/14.52254cec.js"><link rel="prefetch" href="/trainingdays/assets/js/15.881a606b.js"><link rel="prefetch" href="/trainingdays/assets/js/16.20bb6227.js"><link rel="prefetch" href="/trainingdays/assets/js/17.9589d59b.js"><link rel="prefetch" href="/trainingdays/assets/js/18.5e3535f0.js"><link rel="prefetch" href="/trainingdays/assets/js/19.f905987c.js"><link rel="prefetch" href="/trainingdays/assets/js/20.ad66c9cb.js"><link rel="prefetch" href="/trainingdays/assets/js/21.821e9944.js"><link rel="prefetch" href="/trainingdays/assets/js/22.16b2fbac.js"><link rel="prefetch" href="/trainingdays/assets/js/23.afcc765b.js"><link rel="prefetch" href="/trainingdays/assets/js/24.f9576e35.js"><link rel="prefetch" href="/trainingdays/assets/js/25.4ea9fbb6.js"><link rel="prefetch" href="/trainingdays/assets/js/26.571081f6.js"><link rel="prefetch" href="/trainingdays/assets/js/27.b27e39ab.js"><link rel="prefetch" href="/trainingdays/assets/js/28.29d9eff0.js"><link rel="prefetch" href="/trainingdays/assets/js/29.50b9ef2c.js"><link rel="prefetch" href="/trainingdays/assets/js/3.facb358b.js"><link rel="prefetch" href="/trainingdays/assets/js/30.f7b99d34.js"><link rel="prefetch" href="/trainingdays/assets/js/31.970ee1af.js"><link rel="prefetch" href="/trainingdays/assets/js/32.5d462591.js"><link rel="prefetch" href="/trainingdays/assets/js/33.5c05ddd0.js"><link rel="prefetch" href="/trainingdays/assets/js/34.c271178e.js"><link rel="prefetch" href="/trainingdays/assets/js/35.531f7253.js"><link rel="prefetch" href="/trainingdays/assets/js/36.772f25db.js"><link rel="prefetch" href="/trainingdays/assets/js/37.4c50c7ca.js"><link rel="prefetch" href="/trainingdays/assets/js/38.8d07260a.js"><link rel="prefetch" href="/trainingdays/assets/js/39.9eb5cb5e.js"><link rel="prefetch" href="/trainingdays/assets/js/4.bb8b4c8f.js"><link rel="prefetch" href="/trainingdays/assets/js/40.00e63743.js"><link rel="prefetch" href="/trainingdays/assets/js/41.35d9863a.js"><link rel="prefetch" href="/trainingdays/assets/js/42.d4234df6.js"><link rel="prefetch" href="/trainingdays/assets/js/43.798b7f57.js"><link rel="prefetch" href="/trainingdays/assets/js/44.3f90b93c.js"><link rel="prefetch" href="/trainingdays/assets/js/45.e2cc5891.js"><link rel="prefetch" href="/trainingdays/assets/js/46.ac000031.js"><link rel="prefetch" href="/trainingdays/assets/js/47.74f8e834.js"><link rel="prefetch" href="/trainingdays/assets/js/48.8f2af302.js"><link rel="prefetch" href="/trainingdays/assets/js/49.af43454c.js"><link rel="prefetch" href="/trainingdays/assets/js/5.b829b208.js"><link rel="prefetch" href="/trainingdays/assets/js/50.c1dc02b3.js"><link rel="prefetch" href="/trainingdays/assets/js/51.f28c27a8.js"><link rel="prefetch" href="/trainingdays/assets/js/52.8b9f6da7.js"><link rel="prefetch" href="/trainingdays/assets/js/53.4948b738.js"><link rel="prefetch" href="/trainingdays/assets/js/54.784f73bf.js"><link rel="prefetch" href="/trainingdays/assets/js/55.a403d80e.js"><link rel="prefetch" href="/trainingdays/assets/js/56.d0e54075.js"><link rel="prefetch" href="/trainingdays/assets/js/57.f4053177.js"><link rel="prefetch" href="/trainingdays/assets/js/58.38881b1b.js"><link rel="prefetch" href="/trainingdays/assets/js/59.b861a573.js"><link rel="prefetch" href="/trainingdays/assets/js/6.0045f016.js"><link rel="prefetch" href="/trainingdays/assets/js/60.8a74e35f.js"><link rel="prefetch" href="/trainingdays/assets/js/61.fd3c54d0.js"><link rel="prefetch" href="/trainingdays/assets/js/62.354f06bd.js"><link rel="prefetch" href="/trainingdays/assets/js/63.811b5f32.js"><link rel="prefetch" href="/trainingdays/assets/js/64.43d67b13.js"><link rel="prefetch" href="/trainingdays/assets/js/65.958bf89c.js"><link rel="prefetch" href="/trainingdays/assets/js/66.4c85c84f.js"><link rel="prefetch" href="/trainingdays/assets/js/67.87277047.js"><link rel="prefetch" href="/trainingdays/assets/js/68.a1e26552.js"><link rel="prefetch" href="/trainingdays/assets/js/69.6abf7952.js"><link rel="prefetch" href="/trainingdays/assets/js/70.887606cd.js"><link rel="prefetch" href="/trainingdays/assets/js/71.5a54d36e.js"><link rel="prefetch" href="/trainingdays/assets/js/72.0276cac8.js"><link rel="prefetch" href="/trainingdays/assets/js/73.c8e4597d.js"><link rel="prefetch" href="/trainingdays/assets/js/74.7552a6f0.js"><link rel="prefetch" href="/trainingdays/assets/js/75.f1f9e1fb.js"><link rel="prefetch" href="/trainingdays/assets/js/76.bc58f1eb.js"><link rel="prefetch" href="/trainingdays/assets/js/77.9200373a.js"><link rel="prefetch" href="/trainingdays/assets/js/78.98816a5b.js"><link rel="prefetch" href="/trainingdays/assets/js/79.fa586726.js"><link rel="prefetch" href="/trainingdays/assets/js/8.2e19aa78.js"><link rel="prefetch" href="/trainingdays/assets/js/80.64d637c3.js"><link rel="prefetch" href="/trainingdays/assets/js/81.a9f48112.js"><link rel="prefetch" href="/trainingdays/assets/js/9.83296813.js">
    <link rel="stylesheet" href="/trainingdays/assets/css/0.styles.6f1621c0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/trainingdays/" class="home-link router-link-active"><!----> <span class="site-name">Azure Developer College</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/azuredevcollege/trainingdays" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/azuredevcollege/trainingdays" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/trainingdays/" aria-current="page" class="sidebar-link">Home</a></li><li><a href="/trainingdays/day1/" class="sidebar-link">Day 1 Azure Fundamentals &amp; Infrastructure</a></li><li><a href="/trainingdays/day2/" class="sidebar-link">Day 2 Azure Development</a></li><li><a href="/trainingdays/day3/" class="sidebar-link">Day 3 Data and AI</a></li><li><a href="/trainingdays/day4/" class="sidebar-link">Day 4 Azure DevOps</a></li><li><a href="/trainingdays/day5/" aria-current="page" class="sidebar-link">Day 5 Identity and Architecture</a></li><li><a href="/trainingdays/day6/" class="sidebar-link">Day 6 Containerization</a></li><li><a href="/trainingdays/day7/" class="sidebar-link">Day 7 Kubernetes</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="pre-day-5-checkpoint"><a href="#pre-day-5-checkpoint" class="header-anchor">#</a> Pre-day 5 checkpoint</h1> <p>This step by step guide will help you deploy the complete app and DevOps pipelines in a state after completion of day 4.</p> <h2 id="setting-up-the-environment-🔧"><a href="#setting-up-the-environment-🔧" class="header-anchor">#</a> Setting up the environment 🔧</h2> <p>To Setup you environment you will need to:</p> <ol><li>Clone the official training days repository</li> <li>Access you Azure DevOps environment to obtain a personal access token (PAT)</li> <li>Login to your Azure CLI</li> <li>Setup SSH-Keys to allow access to your DevOps projects git repositories</li> <li>Export some of the access credentials as environment variables in your shell</li></ol> <p>Let's get started.</p> <h3 id="clone-the-training-days-repository-🐑🐑"><a href="#clone-the-training-days-repository-🐑🐑" class="header-anchor">#</a> Clone the training days repository 🐑🐑</h3> <p>To clone the official training days repository into you workspace, open a
Linux Shell (e.g. WSL2 or Azure Cloud Shell) and navigate to your workspace
directory.</p> <p>Then you can <em>clone</em> the repository using git like this:</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">git</span> clone https://github.com/azuredevcollege/trainingdays.git
</code></pre></div><p>and change into the folder for the day5 restore checkpoint like this:</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> trainingdays/day5/apps/checkpoint/
</code></pre></div><h3 id="collect-access-information-for-azure-devops-📃"><a href="#collect-access-information-for-azure-devops-📃" class="header-anchor">#</a> Collect access information for Azure DevOps 📃</h3> <p>We will be using terraform with both the Azure Resource Manager and the Azure
DevOps providers. The later requires you to export your Azure DevOps
organizations service URL and a personal access token with administrative
permission in that organization.</p> <p>First grab you Azure DevOps organization service url from you browser:</p> <p><img src="/trainingdays/assets/img/devcollegeurl.81e85837.png" alt=""></p> <p>and export the url as environment variable:</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">AZDO_ORG_SERVICE_URL</span><span class="token operator">=</span>https://dev.azure.com/<span class="token operator">&lt;</span>your_organization<span class="token operator">&gt;</span>
</code></pre></div><p>Now, let's create a personal access token for your Azure DevOps organization.
You can find the option in the top right corner of the Azure DevOps website.</p> <p><img src="/trainingdays/assets/img/PATMenu.cbf82820.png" alt=""></p> <p>Create the new token with Admin permissions in you DevOps organization, as it
needs to be able to create an entire new DevOps Project for you. Choose a name
you can easily remember to delete after you've finished the course. You
don't want to leave the access credentials lying around.</p> <p><img src="/trainingdays/assets/img/TerraformPAT.0420795f.png" alt=""></p> <p>Hit <code>create</code> and take note of the access token after creating the token.</p> <p><img src="/trainingdays/assets/img/SavePAT.81b2c321.png" alt=""></p> <p>and export the personal access token as environment variable:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">AZDO_PERSONAL_ACCESS_TOKEN</span><span class="token operator">=</span>XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
</code></pre></div><p>For terraform to be able to use the Azure Resource Manager APIs in your subscription you need to make sure you're logged into the subscription you want to work with.</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ az login
</code></pre></div><p>To check if the correct subscription is selected you can use the <code>account show</code> command.</p> <div class="language- extra-class"><pre class="language-text"><code>$ az account show
</code></pre></div><p>Should you need to change the subscription, first list the available subscriptions in your account (in table view for better legibility):</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ az account list -o table
</code></pre></div><p>then set the desired subscription using it's unique id:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ az account <span class="token builtin class-name">set</span> --subscription  xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxx
</code></pre></div><h3 id="make-sure-you-have-a-ssh-key-ready-to-use-with-git-🔑🔐"><a href="#make-sure-you-have-a-ssh-key-ready-to-use-with-git-🔑🔐" class="header-anchor">#</a> Make sure you have a ssh-key ready to use with git 🔑🔐</h3> <p>Let's check if you have an ssh key:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">cat</span> ~/.ssh/id_rsa.pub
cat: /home/waltken/.ssh/id_rsa.pub: No such <span class="token function">file</span> or directory
</code></pre></div><p>This would mean that you do not have an existing key around, so let's generate a new one.
We'll create a new 4096 <strong>b</strong>it key with the <strong>C</strong>omment <code>devopsrestore</code> at the default location for ssh keys. A <strong>f</strong>ile named <code>id_rsa</code> in you home-folders <code>.ssh</code> directory.</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ ssh-keygen -b <span class="token number">4096</span> -C devopsrestore -f ~/.ssh/id_rsa
</code></pre></div><blockquote><p>To leave the password empty, just hit return twice</p></blockquote> <p>Now let's grab the corresponding public key:</p> <div class="language- extra-class"><pre class="language-text"><code>$ cat ~/.ssh/id_rsa.pub
ssh-rsa AAAAB3NzaC1yc2EAAA...
...
... devopsrestore
</code></pre></div><p>You'll need to copy multiple lines from <code>ssh-rsa</code> until <code>devopsrestore</code>, the entire public key of of you ssh-key.</p> <p>Now wee need to register the public key to your Azure DevOps user. This allows Azure DevOps to validate you identity without prompting for a password.</p> <p>From the top right menu we used earlier, now select the <code>SSH public keys</code> menu item.</p> <p><img src="/trainingdays/assets/img/sshpubkeymenu.64304e74.png" alt=""></p> <p>You should see a list with you already registered public keys. Don't worry if it's empty. We will now add you first key to the list, by hitting the <code>Add</code> button</p> <p><img src="/trainingdays/assets/img/sshpubkeyadd.35a038ea.png" alt=""></p> <p>Now paste you public key into the <code>Key Data</code> section and give it a name to your liking.</p> <p><img src="/trainingdays/assets/img/sshpubkeypaste.50eb76a3.png" alt=""></p> <blockquote><p>Should you have an existing key with a passphrase you will have to unlock the key for
the <code>terraform apply</code> step about to follow:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token builtin class-name">eval</span> <span class="token variable"><span class="token variable">$(</span>ssh-agent -s<span class="token variable">)</span></span> <span class="token comment"># start the ssh-agent</span>
$ ssh-add ~/.ssh/id_rsa <span class="token comment"># unlock your key for use in this session</span>
</code></pre></div></blockquote> <h3 id="use-terraform-to-setup-the-devops-project-🌏"><a href="#use-terraform-to-setup-the-devops-project-🌏" class="header-anchor">#</a> Use terraform to setup the DevOps project 🌏</h3> <p>Let's make sure you have terraform version v0.13.2 or higher.</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ terraform version
Terraform v0.13.2
</code></pre></div><p>Please update your terraform version, should this not be the case.</p> <p>Now let's initialize terraform and download the required modules and providers:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ terraform init
</code></pre></div><p>We are ready to apply the prepared infrastructure as code (IaC) to you Azure Subscription and Azure DevOps Account.</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ terraform apply
</code></pre></div><p>Make sure that the generated plan only shows new resources to create and then
type <em>yes</em> to confirm the terraform action.</p> <p>Make sure the process runs through without any errors.</p> <p>Congratulations! You are done with the terminal (for now 😉.</p> <h2 id="run-the-pipelines-🏃‍♀️‍"><a href="#run-the-pipelines-🏃‍♀️‍" class="header-anchor">#</a> Run the pipelines 🏃‍♀️‍</h2> <p>The last part will be to run the pre-configured pipelines and find the url of
the deployed website.</p> <p>Let's go the the Azure DevOps Website. Your project pipelines should look like this:</p> <p><img src="/trainingdays/assets/img/blankrestore.4aaa2eda.png" alt=""></p> <p>Before we run any pipeline let's authorize all pipelines to use the
configured Service Connections. In the lower left corner select <code>Project settings</code> and navigate to <code>Service Connections</code>.</p> <p><img src="/trainingdays/assets/img/project_settings.36e5bdbc.png" alt=""></p> <p>You should see to Service Connections configured for you project. Select the
edit option for each of them and make sure the checkbox for <em>Grant access
permission to all pipelines</em> is ticked.</p> <p><img src="/trainingdays/assets/img/grant_permissions.9dec1dc8.png" alt=""></p> <p>Start the <em>SCM Common</em> pipeline first and wait for it to complete. The common
pipeline creates the Azure Resource Group and some share resources that the
other project pipelines depend upon. This will take about 13 minutes to deploy. So let's take a short break, we are almost done.</p> <p><img src="/trainingdays/assets/img/runcommon.300216d8.png" alt=""> <img src="/trainingdays/assets/img/readytorun.d79a8ce8.png" alt=""></p> <blockquote><p>If you notice that it stays pending you need to make sure your Service
Connections grant access to all pipelines first.</p></blockquote> <p><img src="/trainingdays/assets/img/pendingpermission.1e92c2b4.png" alt=""> <img src="/trainingdays/assets/img/permit.36f2bf6c.png" alt=""></p> <p>After the SCM Common pipeline has successfully deployed you can run the rest</p> <p><img src="/trainingdays/assets/img/runpending.e16d69b2.png" alt=""></p> <p>Once all pipelines have passed you should be able to use the webapp without
any errors.</p> <h3 id="discover-the-website-🔍📃"><a href="#discover-the-website-🔍📃" class="header-anchor">#</a> Discover the website 🔍📃</h3> <p>To find your deployed fronted website URL, you can navigate to the
<em>scmvuerestore</em> Storage Account in your newly created resource group. You
will find the <em>Primary endpoint</em> listed under static website in the details of
the storage account.</p> <p><img src="/trainingdays/assets/img/resourcegroups.8c813c69.png" alt=""> <img src="/trainingdays/assets/img/vuerestore.a69d6007.png" alt=""> <img src="/trainingdays/assets/img/static-website.165c2b14.png" alt=""></p> <p>Hooray! 🥳🎈🎉 You've successfully restore to the pre-day5 checkpoint and are ready to go ahead an learn everything about Active Directory integration!</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/azuredevcollege/trainingdays/edit/master/day5/apps/checkpoint/README.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/trainingdays/assets/js/app.41048ffd.js" defer></script><script src="/trainingdays/assets/js/2.8660cf7d.js" defer></script><script src="/trainingdays/assets/js/7.5b737215.js" defer></script>
  </body>
</html>
